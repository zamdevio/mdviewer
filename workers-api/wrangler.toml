name = "mdviewer-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"

# ============================================================================
# ⚠️ IMPORTANT: CONFIGURE THESE VALUES BEFORE DEPLOYING
# ============================================================================
# 
# After cloning this repository, you MUST update the following:
# 1. ALLOWED_ORIGINS - Comma-separated list of allowed frontend origins
# 2. routes (if using custom domain) - Your custom domain configuration
# 3. bucket_name (optional) - Change if you want a different R2 bucket name
#
# ============================================================================

# Environment variables
[vars]
# ⚠️ REQUIRED: Set this to your allowed frontend origins
# 
# Comma-separated list of origins allowed to make CORS requests.
# The API will use the request origin (if allowed) to construct share URLs.
# 
# Options:
# - For Cloudflare Pages: "https://your-project.pages.dev"
# - For custom domain: "https://yourdomain.com"
# - For local development: "http://localhost:3000"
# - Multiple domains: "https://domain1.com,https://domain2.com"
#
# This is used for:
# - CORS headers (allows requests from your frontend(s))
# - Constructing share URLs returned to users (uses the request origin)
#
# Format: Comma-separated list of origins (full URLs or just domains)
# - Full URLs: "https://markview.pages.dev,https://mdviewer.pages.dev"
# - Domains: "markview.pages.dev,mdviewer.pages.dev" (https:// will be added automatically)
#
# Examples:
# ALLOWED_ORIGINS = "https://mdviewer.pages.dev"
# ALLOWED_ORIGINS = "https://mdviewer.yourdomain.com"
# ALLOWED_ORIGINS = "https://markview.pages.dev,https://mdviewer.pages.dev"
ALLOWED_ORIGINS = "https://mdviewer.zamdev.dev,https://markview.pages.dev"

# Rate limiting configuration (optional - defaults shown)
# Adjust these if you want different rate limits
RATE_LIMIT_WINDOW = 60  # Time window in seconds (default: 60 = 1 minute)
RATE_LIMIT_MAX_REQUESTS = 10  # Max requests per window per IP (default: 10)

# ============================================================================
# Custom Domain Routes (Optional)
# ============================================================================
# 
# If you want to use a custom domain instead of the default workers.dev domain,
# uncomment and configure the routes section below.
#
# Steps:
# 1. Add your domain to Cloudflare (if not already added)
# 2. Create a CNAME record pointing to your worker
# 3. Uncomment and update the routes section below
# 4. Replace "api.yourdomain.com" with your actual API subdomain
# 5. Replace "yourdomain.com" with your actual domain
#
# Example for api.mdviewer.zamdev.dev:
[[routes]]
pattern = "api.mdviewer.zamdev.dev"
zone_name = "zamdev.dev"
custom_domain = true


# [[routes]]
# pattern = "api.yourdomain.com"
# zone_name = "yourdomain.com"
# custom_domain = true

# R2 Bucket binding
# ⚠️ OPTIONAL: Change "mdviewer" to your preferred bucket name
# Make sure to create the bucket first: wrangler r2 bucket create <your-bucket-name>
[[r2_buckets]]
binding = "R2_BUCKET"
bucket_name = "mdviewer"

# Durable Objects for rate limiting
[[durable_objects.bindings]]
name = "RATE_LIMITER"
class_name = "RateLimiter"

# Durable Object migrations
[[migrations]]
tag = "v1"
new_sqlite_classes = ["RateLimiter"]
